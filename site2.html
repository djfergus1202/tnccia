<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Aether: Interactive Career & Study Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  <style>
    :root {
      --bg-main: #f3f2ef;
      --bg-alt: #ffffff;
      --text-primary: #1f2937;
      --text-secondary: #4b5563;
      --accent-primary: #0a66c2;
      --accent-secondary: #004182;
      --border-color: #e0e0e0;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: system-ui, sans-serif;
      background: var(--bg-main);
      color: var(--text-primary);
    }
    header {
      background: var(--bg-alt);
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      position: fixed; top:0; width:100%; z-index:50;
    }
    header .container {
      max-width:1200px; margin:auto;
      display:flex; justify-content:space-between; align-items:center;
      padding:.75rem 1rem;
    }
    header .logo { color:var(--accent-primary); font-weight:700; font-size:1.5rem; cursor:pointer; }
    #sidebar {
      background: var(--bg-alt);
      border-right:1px solid var(--border-color);
      padding:1rem;
      height:100vh; position:sticky; top:0;
    }
    #sidebar .profile-card { text-align:center; margin-bottom:2rem;}
    #sidebar .profile-card img { width:4rem; height:4rem; border-radius:50%; }
    #sidebar .profile-card h2 { margin:.5rem 0 0; font-weight:600; }
    #sidebar .profile-card p { margin:.25rem 0; font-size:.875rem; color:var(--text-secondary); }
    #sidebar .menu button {
      width:100%; text-align:left; padding:.75rem; border:none; background:transparent;
      cursor:pointer; transition:background .2s;
    }
    #sidebar .menu button:hover { background:rgba(0,0,0,0.03); }
    .nav-button.active { color:var(--accent-primary); font-weight:600; }
    .content-section { display:none; animation:fadeIn .3s ease-in-out;}
    .content-section.active { display:block;}
    @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
    .card {
      background:var(--bg-alt); border:1px solid var(--border-color); border-radius:.75rem;
      box-shadow:0 4px 10px rgba(0,0,0,0.05); padding:1rem; margin-bottom:1.5rem;
    }
    .card h3 { font-weight:600; margin-bottom:.5rem; }
    .card p { color:var(--text-secondary); line-height:1.4; }
    #loading-overlay {
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(255,255,255,0.75); z-index:100; visibility:hidden;
    }
    .loader {
      border:4px solid #f3f3f3; border-top:4px solid var(--accent-primary);
      border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite;
    }
    @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
    /* Auth & Reg */
    #auth-page, #registration-page {
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,0.05); z-index:200;
    }
    .auth-container {
      background:var(--bg-alt); max-width:400px; width:100%; padding:2rem;
      border-radius:1rem; box-shadow:0 10px 25px rgba(0,0,0,0.1);
    }
    .auth-tabs { display:flex; margin-bottom:1rem; }
    .auth-tabs button {
      flex:1; padding:.75rem; font-size:1.125rem; border:none; background:transparent;
      cursor:pointer; transition:background .2s;
    }
    .auth-tabs button.active { border-bottom:3px solid var(--accent-primary); font-weight:600;}
    .auth-form input {
      width:100%; padding:.75rem; border:1px solid var(--border-color);
      border-radius:.5rem; margin-bottom:.5rem; outline:none;
      transition:border .2s;
    }
    .auth-form input:focus { border-color:var(--accent-primary); }
    .auth-form .btn {
      width:100%; padding:.75rem; border:none; border-radius:.5rem;
      background:var(--accent-primary); color:#fff; font-weight:600;
      cursor:pointer; transition:background .2s;
    }
    .auth-form .btn:hover { background:var(--accent-secondary); }
    .auth-error { color:#dc2626; font-size:.875rem; text-align:center; margin-top:.5rem; }
    /* Mind Map */
    #mind-map-modal {
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,0.7); backdrop-filter:blur(5px); z-index:150;
      visibility:hidden;
    }
    #mind-map-modal.active { visibility:visible; }
    #mind-map-modal .modal-container {
      background:var(--bg-alt); border-radius:1rem; overflow:hidden;
      width:90%; max-width:1000px; height:85vh; display:flex; flex-direction:column;
    }
    #mind-map-modal .modal-header {
      display:flex; justify-content:space-between; align-items:center;
      border-bottom:1px solid var(--border-color); padding:.75rem 1rem;
    }
    #mind-map-modal .close-btn {
      background:transparent; border:none; font-size:1.5rem; cursor:pointer;
    }
    #mind-map-container {
      flex:1; position:relative; background:#1e293b;
      background-image:radial-gradient(rgba(255,255,255,0.1)1px,transparent1px);
      background-size:20px 20px; cursor:grab;
    }
    .puzzle-node {
      position:absolute; width:140px; height:100px;
      display:flex; align-items:center; justify-content:center; text-align:center;
      padding:.5rem; font-weight:600; color:#fff; cursor:grab; user-select:none;
      border:2px solid rgba(255,255,255,0.5); border-radius:.75rem;
      box-shadow:0 5px 15px rgba(0,0,0,0.4);
      transition:transform .2s,box-shadow .2s,background-color .3s;
    }
    .puzzle-node:hover { transform:scale(1.05); box-shadow:0 8px 20px rgba(0,0,0,0.5); }
    .puzzle-node.selected {
      outline:3px solid #facc15; box-shadow:0 0 20px #facc15; z-index:100;
    }
    #node-editor {
      position:absolute; top:10px; right:10px;
      background:var(--bg-alt); padding:1rem; border-radius:.5rem;
      box-shadow:0 4px 20px rgba(0,0,0,0.25);
      z-index:200; display:none; width:280px;
    }
    #mind-map-svg {
      position:absolute; top:0; left:0; width:100%; height:100%;
      pointer-events:none; z-index:10;
    }
    #mind-map-svg line {
      stroke:rgba(255,255,255,0.4); stroke-width:3;
    }
  </style>
</head>
<body class="antialiased">

  <!-- Loading -->
  <div id="loading-overlay"><div class="loader"></div></div>

  <!-- Authentication -->
  <div id="auth-page">
    <div class="auth-container">
      <h1 class="text-2xl font-bold text-center text-accent-primary mb-4">Aether</h1>
      <div class="auth-tabs">
        <button id="tab-login" class="active">Login</button>
        <button id="tab-signup">Sign Up</button>
      </div>
      <form id="form-login" class="auth-form">
        <input type="email" id="login-email" placeholder="Email" required>
        <input type="password" id="login-password" placeholder="Password" required>
        <button type="submit" class="btn">Log In</button>
        <p id="error-login" class="auth-error"></p>
      </form>
      <form id="form-signup" class="auth-form hidden">
        <input type="text" id="signup-name" placeholder="Full Name" required>
        <input type="email" id="signup-email" placeholder="Email" required>
        <input type="password" id="signup-password" placeholder="Password (min 6)" required>
        <input type="text" id="signup-headline" placeholder="Professional Headline">
        <button type="submit" class="btn">Create Account</button>
        <p id="error-signup" class="auth-error"></p>
      </form>
    </div>
  </div>

  <!-- Registration (simple profile setup) -->
  <div id="registration-page" class="hidden">
    <div class="auth-container">
      <h1 class="text-3xl font-black text-center text-accent-primary mb-4">Welcome to Aether</h1>
      <form id="regForm" class="space-y-4">
        <input type="text" id="reg-fullName" placeholder="Full Name" required class="auth-form-input">
        <input type="email" id="reg-email" placeholder="Email" required class="auth-form-input">
        <input type="text" id="reg-headline" placeholder="Professional Headline" class="auth-form-input">
        <button type="submit" class="btn w-full">Start</button>
      </form>
    </div>
  </div>

  <!-- Main Application -->
  <div id="main-app" class="hidden flex">
    <!-- Sidebar -->
    <aside id="sidebar">
      <div class="profile-card">
        <img id="profile-avatar" src="https://i.pravatar.cc/80" alt="Avatar">
        <h2 id="profile-name">Your Name</h2>
        <p id="profile-headline">Headline</p>
      </div>
      <div class="menu">
        <button class="nav-button active" data-target="feed">Feed</button>
        <button class="nav-button" data-target="mindmap">Mind Map</button>
        <button class="nav-button" data-target="learning">Learning Hub</button>
        <button id="admin-btn" class="nav-button hidden" data-target="admin">Admin Panel</button>
      </div>
    </aside>

    <!-- Content Area -->
    <main id="content-area">
      <!-- Strategy Feed -->
      <section id="feed" class="content-section active">
        <div class="card">
          <h3>Add to your strategy</h3>
          <div class="flex space-x-2 mt-2">
            <button id="add-note-btn" class="btn">üìù Note</button>
            <button id="add-goal-btn" class="btn">üéØ Goal</button>
          </div>
        </div>
        <div id="strategy-feed"></div>
      </section>

      <!-- Mind Map Section -->
      <section id="mindmap" class="content-section">
        <div class="card">
          <h3>Uncertainty-Aware Mind Map</h3>
          <p class="text-sm text-text-secondary">Double-click to add a node. Shift-click two nodes to connect them.</p>
          <button id="open-map-btn" class="btn mt-3">Open Mind Map</button>
        </div>
      </section>

      <!-- Learning Hub (stub) -->
      <section id="learning" class="content-section">
        <div class="card">
          <h3>Learning Hub</h3>
          <p>Flashcards, quizzes, CV generator (coming soon!).</p>
        </div>
      </section>

      <!-- Admin Panel (local DB) -->
      <section id="admin" class="content-section">
        <div class="card">
          <h3>Admin Panel</h3>
          <p>Manage local users & data.</p>
          <button id="open-admin-btn" class="btn mt-3">Open Admin Panel</button>
        </div>
      </section>
    </main>
  </div>

  <!-- Mind Map Modal -->
  <div id="mind-map-modal">
    <div class="modal-container">
      <div class="modal-header">
        <h2>Mind Map</h2>
        <button class="close-btn" id="close-map-btn">&times;</button>
      </div>
      <div id="mind-map-container"></div>
    </div>
  </div>

  <!-- Admin Modal -->
  <div id="admin-modal" class="fixed inset-0 hidden items-center justify-center bg-black bg-opacity-50">
    <div class="auth-container max-w-3xl">
      <h2 class="text-xl font-semibold mb-4">Admin Panel</h2>
      <div id="admin-user-list" class="max-h-80 overflow-y-auto space-y-2"></div>
      <button id="close-admin-btn" class="btn w-full mt-4">Close</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- LocalStorage Helpers ---
      function loadUsers() {
        return JSON.parse(localStorage.getItem('aetherUsers')||'[]');
      }
      function saveUsers(u) {
        localStorage.setItem('aetherUsers', JSON.stringify(u));
      }
      function getCurrent() {
        return localStorage.getItem('aetherCurrent');
      }
      function setCurrent(email) {
        localStorage.setItem('aetherCurrent', email);
      }
      function clearCurrent() {
        localStorage.removeItem('aetherCurrent');
      }

      // --- UI Refs ---
      const loading = document.getElementById('loading-overlay');
      const authPage = document.getElementById('auth-page');
      const regPage = document.getElementById('registration-page');
      const mainApp = document.getElementById('main-app');
      const tabLogin = document.getElementById('tab-login');
      const tabSignup = document.getElementById('tab-signup');
      const formLogin = document.getElementById('form-login');
      const formSignup = document.getElementById('form-signup');
      const errLogin = document.getElementById('error-login');
      const errSignup = document.getElementById('error-signup');
      const regForm = document.getElementById('regForm');
      const sidebarBtns = document.querySelectorAll('#sidebar .menu button');
      const sections = document.querySelectorAll('.content-section');
      const signOutBtn = document.getElementById('sign-out-btn');
      const addNoteBtn = document.getElementById('add-note-btn');
      const addGoalBtn = document.getElementById('add-goal-btn');
      const strategyFeed = document.getElementById('strategy-feed');
      const openMapBtn = document.getElementById('open-map-btn');
      const mapModal = document.getElementById('mind-map-modal');
      const closeMapBtn = document.getElementById('close-map-btn');
      const mapContainer = document.getElementById('mind-map-container');
      const adminModal = document.getElementById('admin-modal');
      const openAdminBtn = document.getElementById('open-admin-btn');
      const closeAdminBtn = document.getElementById('close-admin-btn');
      const adminList = document.getElementById('admin-user-list');
      const profileAvatar = document.getElementById('profile-avatar');
      const profileName = document.getElementById('profile-name');
      const profileHeadline = document.getElementById('profile-headline');

      // --- Auth Tabs ---
      function showLogin() {
        tabLogin.classList.add('active');
        tabSignup.classList.remove('active');
        formLogin.classList.remove('hidden');
        formSignup.classList.add('hidden');
        errLogin.textContent='';
      }
      function showSignup() {
        tabSignup.classList.add('active');
        tabLogin.classList.remove('active');
        formSignup.classList.remove('hidden');
        formLogin.classList.add('hidden');
        errSignup.textContent='';
      }
      tabLogin.addEventListener('click',showLogin);
      tabSignup.addEventListener('click',showSignup);

      // --- Registration Form (collects profile) ---
      regForm.addEventListener('submit',e=>{
        e.preventDefault();
        const fullName = document.getElementById('reg-fullName').value.trim();
        const email    = document.getElementById('reg-email').value.trim();
        const headline = document.getElementById('reg-headline').value.trim();
        let users = loadUsers();
        if(users.find(u=>u.email===email)){
          alert('Email already registered.');
          return;
        }
        users.push({
          email, password:'',// no password on first step
          fullName, headline,
          avatarUrl:`https://i.pravatar.cc/150?u=${email}`,
          feed:[], mindMap:{nodes:[],connections:[]}
        });
        saveUsers(users);
        // Next, ask for password
        authPage.classList.remove('hidden');
        regPage.classList.add('hidden');
        showSignup();
      });

      // --- Signup (set password) ---
      formSignup.addEventListener('submit',e=>{
        e.preventDefault();
        const name     = document.getElementById('signup-name').value.trim();
        const email    = document.getElementById('signup-email').value.trim();
        const password = document.getElementById('signup-password').value;
        const headline = document.getElementById('signup-headline').value.trim();
        let users = loadUsers();
        const u = users.find(u=>u.email===email);
        if(!u){
          errSignup.textContent="No registration found for that email.";
          return;
        }
        u.password = password;
        u.fullName = name;
        u.headline = headline;
        saveUsers(users);
        // auto-login
        setCurrent(email);
        showApp(u);
      });

      // --- Login ---
      formLogin.addEventListener('submit',e=>{
        e.preventDefault();
        const email    = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;
        let users = loadUsers();
        const u = users.find(u=>u.email===email && u.password===password);
        if(!u){
          errLogin.textContent="Invalid email/password.";
          return;
        }
        setCurrent(email);
        showApp(u);
      });

      // --- Logout ---
      signOutBtn.addEventListener('click',()=>{
        clearCurrent();
        location.reload();
      });

      // --- Navigation ---
      sidebarBtns.forEach(btn=>{
        btn.addEventListener('click',()=>{
          sidebarBtns.forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          const tgt=btn.dataset.target;
          sections.forEach(s=>{
            s.id===tgt? s.classList.add('active'): s.classList.remove('active');
          });
        });
      });

      // --- Show main app ---
      function showApp(user){
        authPage.classList.add('hidden');
        regPage.classList.add('hidden');
        mainApp.classList.remove('hidden');
        profileAvatar.src = user.avatarUrl;
        profileName.textContent = user.fullName;
        profileHeadline.textContent = user.headline;
        renderFeed(user);
        setupFeedButtons(user);
        setupMindMap(user);
        setupAdmin();
      }

      // --- Strategy Feed ---
      function renderFeed(user){
        strategyFeed.innerHTML = user.feed.map(item=>
          `<div class="card"><p>${item.content}</p>
           <p class="text-xs text-text-secondary mt-1">${new Date(item.timestamp).toLocaleString()}</p></div>`
        ).join('');
      }
      function setupFeedButtons(user){
        addNoteBtn.onclick = async ()=>{
          const txt=prompt("Enter note:");
          if(!txt)return;
          user.feed.unshift({content:txt,timestamp:Date.now()});
          saveUser(user);
          renderFeed(user);
        };
        addGoalBtn.onclick = async ()=>{
          const txt=prompt("Enter goal:");
          if(!txt)return;
          user.feed.unshift({content:`üéØ ${txt}`,timestamp:Date.now()});
          saveUser(user);
          renderFeed(user);
        };
      }
      function saveUser(u){
        let users=loadUsers();
        const idx=users.findIndex(x=>x.email===u.email);
        users[idx]=u;
        saveUsers(users);
      }

      // --- Mind Map ---
      function setupMindMap(user){
        openMapBtn.onclick = ()=> mapModal.classList.add('active');
        closeMapBtn.onclick= ()=> mapModal.classList.remove('active');
        mapModal.querySelector('.modal-container').focus();
        renderMindMap(user);
      }
      function renderMindMap(user){
        mapContainer.innerHTML = '';
        const svg=document.createElementNS("http://www.w3.org/2000/svg","svg");
        svg.id="mind-map-svg"; mapContainer.appendChild(svg);

        const editor = document.createElement('div');
        editor.id='node-editor';
        editor.innerHTML=`
          <h3 class="font-bold mb-2">Edit Goal</h3>
          <div class="mb-2">
            <label class="block text-sm">Goal Name</label>
            <input type="text" id="node-label" class="w-full p-1 border rounded mt-1"/>
          </div>
          <div class="mb-2">
            <label class="block text-sm">Uncertainty: <span id="uncertainty-value">5</span></label>
            <input type="range" id="node-uncertainty" min="1" max="10" value="5" class="w-full mt-1"/>
          </div>
          <div class="flex justify-between mt-4">
            <button id="delete-node-btn" class="text-sm text-red-600">Delete</button>
            <button id="close-editor" class="text-sm text-gray-600">Close</button>
          </div>`;
        mapContainer.appendChild(editor);

        let nodes = user.mindMap.nodes || [];
        let conns = user.mindMap.connections || [];

        const lbl = editor.querySelector('#node-label');
        const rng = editor.querySelector('#node-uncertainty');
        const val = editor.querySelector('#uncertainty-value');
        const del = editor.querySelector('#delete-node-btn');
        const clo = editor.querySelector('#close-editor');
        let active = null;

        function saveMap(){
          user.mindMap={nodes,connections:conns};
          saveUser(user);
        }
        function drawConns(){
          svg.innerHTML='';
          conns.forEach(c=>{
            const f=nodes.find(n=>n.id===c.from);
            const t=nodes.find(n=>n.id===c.to);
            if(!f||!t)return;
            const l=document.createElementNS("http://www.w3.org/2000/svg","line");
            const r1=f.el.getBoundingClientRect(),r2=t.el.getBoundingClientRect();
            const p=mapContainer.getBoundingClientRect();
            l.setAttribute("x1",r1.left-p.left+r1.width/2);
            l.setAttribute("y1",r1.top-p.top+r1.height/2);
            l.setAttribute("x2",r2.left-p.left+r2.width/2);
            l.setAttribute("y2",r2.top-p.top+r2.height/2);
            svg.appendChild(l);
          });
        }
        function updateNode(n){
          const u=n.data.uncertainty;
          const r=Math.floor(240-140*(u/10)),
                g=Math.floor(150-50*(u/10)),
                b=Math.floor(250-200*(u/10));
          n.el.style.backgroundColor=`rgb(${r},${g},${b})`;
        }
        function openEd(n){
          if(active) active.el.classList.remove('selected');
          active=n; n.el.classList.add('selected');
          editor.style.display='block';
          lbl.value=n.data.label;
          rng.value=n.data.uncertainty;
          val.textContent=n.data.uncertainty;
        }
        lbl.oninput = ()=>{ if(!active)return; active.data.label=lbl.value; active.el.textContent=lbl.value; saveMap(); };
        rng.oninput = ()=>{
          if(!active)return;
          const u=parseInt(rng.value);
          active.data.uncertainty=u;
          val.textContent=u;
          updateNode(active);
          saveMap();
        };
        clo.onclick = ()=>{ if(active)active.el.classList.remove('selected'); editor.style.display='none'; active=null; };
        del.onclick = ()=>{
          if(!active)return;
          mapContainer.removeChild(active.el);
          nodes=nodes.filter(n=>n!==active);
          conns=conns.filter(c=>c.from!==active.data.id && c.to!==active.data.id);
          editor.style.display='none'; active=null;
          saveMap(); drawConns();
        };
        mapContainer.ondblclick=e=>{
          if(e.target!==mapContainer)return;
          const r=mapContainer.getBoundingClientRect();
          const x=e.clientX-r.left-70,
                y=e.clientY-r.top-50;
          const text=prompt("Enter goal:");
          if(!text)return;
          const d={x,y,label:text,uncertainty:5,id:Date.now()};
          createNode(d); nodes.push(d);
          saveMap(); drawConns();
        };
        function createNode(data){
          const d=document.createElement('div');
          d.className='puzzle-node'; d.textContent=data.label;
          d.style.transform=`translate(${data.x}px,${data.y}px)`;
          d.dataset.id=data.id;
          mapContainer.appendChild(d);
          const node={el:d,data};
          updateNode(node);
          d.addEventListener('click',ev=>{
            ev.stopPropagation();
            if(ev.shiftKey && active && active!==node){
              conns.push({from:active.data.id,to:node.data.id});
              saveMap(); drawConns();
            } else openEd(node);
          });
          return node;
        }
        const nodeObjs = nodes.map(d=>createNode(d));
        drawConns();
        interact('.puzzle-node').draggable({
          listeners:{move(ev){
            const id=ev.target.dataset.id;
            const n=nodes.find(x=>x.id==id);
            n.x+=ev.dx;n.y+=ev.dy;
            ev.target.style.transform=`translate(${n.x}px,${n.y}px)`;
            drawConns();
          },end(){saveMap()}}
        });
      }

      // --- Admin Panel (local) ---
      openAdminBtn.onclick = ()=>{
        adminModal.classList.remove('hidden');
        const users=loadUsers();
        adminList.innerHTML = users.map(u=>
          `<div class="card p-2"><p class="font-semibold">${u.fullName}</p><p class="text-sm">${u.email}</p></div>`
        ).join('');
      };
      closeAdminBtn.onclick = ()=> adminModal.classList.add('hidden');

      // --- Init on load ---
      const cur = getCurrent();
      if(cur){
        const u = loadUsers().find(x=>x.email===cur);
        if(u) showApp(u);
        else { clearCurrent(); authPage.classList.remove('hidden'); }
      } else {
        authPage.classList.remove('hidden');
      }
    });
  </script>
</body>
</html>
